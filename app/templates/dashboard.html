{% extends "base.html" %}

{% block content %}
<div class="modern-dashboard">
    <!-- Header with Actions -->
    <div class="dashboard-header">
        <div class="header-left">
            <h1 class="gradient-text">Smart City Traffic Control</h1>
            <p class="subtitle">Real-time Traffic Management System</p>
        </div>
        <div class="header-actions">
            <button class="btn btn-primary" onclick="openModal('cityModal')">
                <span>âž•</span> Add City
            </button>
            <button class="btn btn-secondary" onclick="openModal('areaModal')">
                <span>âž•</span> Add Area
            </button>
            <button class="btn btn-secondary" onclick="openModal('intersectionModal')">
                <span>âž•</span> Add Intersection
            </button>
        </div>
    </div>

    <!-- Main Layout -->
    <div class="dashboard-layout">
        <!-- Sidebar -->
        <aside class="glass-sidebar">
            <h3>Cities & Areas</h3>
            <div id="cityTree" class="city-tree">
                <!-- Will be populated by JavaScript -->
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div id="intersectionsGrid" class="intersections-grid">
                <!-- Will be populated by JavaScript -->
            </div>
        </main>
    </div>
</div>

<!-- Modals -->
<div id="cityModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">Manage City</h2>
            <p class="modal-subtitle">Add or edit city details</p>
        </div>
        <form id="cityForm">
            <input type="hidden" id="cityId">
            <div class="form-group">
                <label class="form-label">City Name</label>
                <input type="text" id="cityName" placeholder="e.g. New York" required>
            </div>
            <div class="form-group">
                <label class="form-label">City Code</label>
                <input type="text" id="cityCode" placeholder="e.g. NYC" required>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn-cancel" onclick="closeModal('cityModal')">Cancel</button>
                <button type="submit" class="btn-submit">Save City</button>
            </div>
        </form>
    </div>
</div>

<div id="areaModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">Manage Area</h2>
            <p class="modal-subtitle">Define a new traffic zone</p>
        </div>
        <form id="areaForm">
            <input type="hidden" id="areaId">
            <div class="form-group">
                <label class="form-label">Parent City</label>
                <select id="areaCity" required>
                    <option value="">Select City</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Area Name</label>
                <input type="text" id="areaName" placeholder="e.g. Downtown" required>
            </div>
            <div class="form-group">
                <label class="form-label">Area Code</label>
                <input type="text" id="areaCode" placeholder="e.g. DT-01" required>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn-cancel" onclick="closeModal('areaModal')">Cancel</button>
                <button type="submit" class="btn-submit">Save Area</button>
            </div>
        </form>
    </div>
</div>

<div id="intersectionModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">Add Intersection</h2>
            <p class="modal-subtitle">Create a new 4-way intersection</p>
        </div>
        <form id="intersectionForm">
            <div class="form-group">
                <label class="form-label">Area</label>
                <select id="intersectionArea" required>
                    <option value="">Select Area</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Intersection Name</label>
                <input type="text" id="intersectionName" placeholder="e.g. 5th Ave & Main St" required>
            </div>
            <div class="form-group">
                <label class="form-label">Intersection Code</label>
                <input type="text" id="intersectionCode" placeholder="e.g. INT-001" required>
            </div>
            <div class="form-group">
                <label class="form-label">Location Coordinates</label>
                <input type="text" id="intersectionLocation" placeholder="e.g. 40.7128, -74.0060" required>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn-cancel" onclick="closeModal('intersectionModal')">Cancel</button>
                <button type="submit" class="btn-submit">Create Intersection</button>
            </div>
        </form>
    </div>
</div>

<div id="lightModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">Manual Control</h2>
            <p class="modal-subtitle">Override automatic traffic logic</p>
        </div>
        <form id="lightForm">
            <input type="hidden" id="lightId">
            <div class="form-group">
                <label class="form-label">Force Status</label>
                <select id="lightStatus">
                    <option value="RED">ðŸ”´ RED</option>
                    <option value="YELLOW">ðŸŸ¡ YELLOW</option>
                    <option value="GREEN">ðŸŸ¢ GREEN</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Duration (seconds)</label>
                <input type="number" id="lightDuration" min="5" max="300" value="60">
            </div>
            <div class="modal-actions">
                <button type="button" class="btn-cancel" onclick="closeModal('lightModal')">Cancel</button>
                <button type="button" class="btn-secondary" id="resetLightBtn" style="background: #475569; margin-right: 10px;">Reset to Auto</button>
                <button type="submit" class="btn-submit">Apply Override</button>
            </div>
        </form>
    </div>
</div>

<script type="module" src="/static/js/modules/main.js"></script>
{% endblock %}
